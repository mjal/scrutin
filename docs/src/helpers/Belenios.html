<!DOCTYPE html>

<html>
<head>
  <title>Belenios.res</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../App.html">
                  src/App.res
                </a>
              
                
                <a class="source" href="../Core.html">
                  src/Core.res
                </a>
              
                
                <a class="source" href="../Route.html">
                  src/Route.res
                </a>
              
                
                <a class="source" href="../State.html">
                  src/State.res
                </a>
              
                
                <a class="source" href="../StateEffect.html">
                  src/StateEffect.res
                </a>
              
                
                <a class="source" href="../StateMsg.html">
                  src/StateMsg.res
                </a>
              
                
                <a class="source" href="Belenios.html">
                  src/helpers/Belenios.res
                </a>
              
                
                <a class="source" href="Config.html">
                  src/helpers/Config.res
                </a>
              
                
                <a class="source" href="Context.html">
                  src/helpers/Context.res
                </a>
              
                
                <a class="source" href="Credential.html">
                  src/helpers/Credential.res
                </a>
              
                
                <a class="source" href="Dimension.html">
                  src/helpers/Dimension.res
                </a>
              
                
                <a class="source" href="EmailValidator.html">
                  src/helpers/EmailValidator.res
                </a>
              
                
                <a class="source" href="IO.html">
                  src/helpers/IO.res
                </a>
              
                
                <a class="source" href="Mailer.html">
                  src/helpers/Mailer.res
                </a>
              
                
                <a class="source" href="Sjcl.html">
                  src/helpers/Sjcl.res
                </a>
              
                
                <a class="source" href="URL.html">
                  src/helpers/URL.res
                </a>
              
                
                <a class="source" href="X.html">
                  src/helpers/X.res
                </a>
              
                
                <a class="source" href="../model/Ballot.html">
                  src/model/Ballot.res
                </a>
              
                
                <a class="source" href="../model/Contact.html">
                  src/model/Contact.res
                </a>
              
                
                <a class="source" href="../model/Election.html">
                  src/model/Election.res
                </a>
              
                
                <a class="source" href="../model/Identity.html">
                  src/model/Identity.res
                </a>
              
                
                <a class="source" href="../model/Transaction.html">
                  src/model/Transaction.res
                </a>
              
                
                <a class="source" href="../model/Trustee.html">
                  src/model/Trustee.res
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Belenios.res</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-variable language_">module</span> <span class="hljs-title class_">Credentials</span> = {
  @<span class="hljs-title function_">module</span>(<span class="hljs-string">&quot;./belenios&quot;</span>) @<span class="hljs-title function_">scope</span>(<span class="hljs-string">&quot;belenios&quot;</span>) @val external <span class="hljs-attr">create</span>: <span class="hljs-function">(<span class="hljs-params">string, int</span>) =&gt;</span> (array&lt;string&gt;, array&lt;string&gt;) = <span class="hljs-string">&quot;makeCredentials&quot;</span>

  @<span class="hljs-title function_">module</span>(<span class="hljs-string">&quot;./belenios&quot;</span>) @<span class="hljs-title function_">scope</span>(<span class="hljs-string">&quot;belenios&quot;</span>) @val external <span class="hljs-attr">derive</span>: <span class="hljs-function">(<span class="hljs-params">~uuid: string, ~privateCredential: string</span>) =&gt;</span> (string) = <span class="hljs-string">&quot;derive&quot;</span>

  type t = array&lt;string&gt;
  external <span class="hljs-attr">parse</span>: <span class="hljs-function">(<span class="hljs-params">string</span>) =&gt;</span> t = <span class="hljs-string">&quot;JSON.parse&quot;</span>
  external <span class="hljs-attr">stringify</span>: <span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> string = <span class="hljs-string">&quot;JSON.stringify&quot;</span>
}

<span class="hljs-variable language_">module</span> <span class="hljs-title class_">Trustees</span> = {

  <span class="hljs-variable language_">module</span> <span class="hljs-title class_">Privkey</span> = {
    type t

    external <span class="hljs-attr">of_str</span>: <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> t = <span class="hljs-string">&quot;%identity&quot;</span>
    external <span class="hljs-attr">to_str</span>: <span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> string = <span class="hljs-string">&quot;%identity&quot;</span>
  }

  type t

  @<span class="hljs-title function_">module</span>(<span class="hljs-string">&quot;./belenios&quot;</span>) @<span class="hljs-title function_">scope</span>(<span class="hljs-string">&quot;belenios&quot;</span>) @val external <span class="hljs-attr">create</span>: <span class="hljs-function">() =&gt;</span> (<span class="hljs-title class_">Privkey</span>.<span class="hljs-property">t</span>, t) = <span class="hljs-string">&quot;genTrustee&quot;</span>

  <span class="hljs-keyword">let</span> pubkey : <span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> string = %<span class="hljs-title function_">raw</span>(<span class="hljs-string">`
    function(e) {
      var pubkey = JSON.parse(e)[0][1][&quot;public_key&quot;];
      console.log(pubkey);
      return pubkey;
    }
  `</span>)

  external <span class="hljs-attr">of_str</span>: <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> t = <span class="hljs-string">&quot;%identity&quot;</span>
  external <span class="hljs-attr">to_str</span>: <span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> string = <span class="hljs-string">&quot;%identity&quot;</span>
}

<span class="hljs-variable language_">module</span> <span class="hljs-title class_">Ballot</span> = {
  type t

  external <span class="hljs-attr">of_str</span>: <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> t = <span class="hljs-string">&quot;%identity&quot;</span>
  external <span class="hljs-attr">to_str</span>: <span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> string = <span class="hljs-string">&quot;%identity&quot;</span>

  <span class="hljs-variable language_">module</span> <span class="hljs-title class_">Parsed</span> = {
    type t = {
      <span class="hljs-attr">credential</span>: string
    }
    external <span class="hljs-attr">parse</span>: <span class="hljs-function">(<span class="hljs-params">string</span>) =&gt;</span> t = <span class="hljs-string">&quot;JSON.parse&quot;</span>
    external <span class="hljs-attr">stringify</span>: <span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> string = <span class="hljs-string">&quot;JSON.stringify&quot;</span>
  }

  <span class="hljs-keyword">let</span> setCredential : <span class="hljs-function">(<span class="hljs-params">t, string</span>) =&gt;</span> t = %<span class="hljs-title function_">raw</span>(<span class="hljs-string">`function(t, credential) {
    var o = JSON.parse(t)
    o.credential = credential
    return JSON.stringify(o)
  }`</span>)
}

<span class="hljs-variable language_">module</span> <span class="hljs-title class_">PartialDecryption</span> = {
  type t1
  type t2
}

<span class="hljs-variable language_">module</span> <span class="hljs-title class_">Election</span> = {
  type question_t = {
    <span class="hljs-attr">question</span>: string,
    <span class="hljs-attr">max</span>: int,
    <span class="hljs-attr">min</span>: int,
    <span class="hljs-attr">blank</span>: bool,
    <span class="hljs-attr">answers</span>: array&lt;string&gt;
  }

  type t = {
    <span class="hljs-attr">version</span>: string,
    <span class="hljs-attr">uuid</span>: string,
    <span class="hljs-attr">name</span>: string,
    <span class="hljs-attr">description</span>: string,
    <span class="hljs-attr">group</span>: string,
    <span class="hljs-attr">public_key</span>: string,
    <span class="hljs-attr">questions</span>: array&lt;question_t&gt;
  }

  external <span class="hljs-attr">parse</span>: <span class="hljs-function">(<span class="hljs-params">string</span>) =&gt;</span> t = <span class="hljs-string">&quot;JSON.parse&quot;</span>
  external <span class="hljs-attr">stringify</span>: <span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> string = <span class="hljs-string">&quot;JSON.stringify&quot;</span>

  @<span class="hljs-title function_">module</span>(<span class="hljs-string">&quot;./belenios&quot;</span>) @<span class="hljs-title function_">scope</span>(<span class="hljs-string">&quot;belenios&quot;</span>) @val external <span class="hljs-attr">_create</span>: <span class="hljs-function">(<span class="hljs-params">~name: string, ~description: string, ~choices: array&lt;string&gt;, ~trustees: Trustees.t</span>) =&gt;</span> string = <span class="hljs-string">&quot;makeElection&quot;</span>
  @<span class="hljs-title function_">module</span>(<span class="hljs-string">&quot;./belenios&quot;</span>) @<span class="hljs-title function_">scope</span>(<span class="hljs-string">&quot;belenios&quot;</span>) @val external <span class="hljs-attr">_vote</span>: <span class="hljs-function">(<span class="hljs-params">string, ~cred: string, ~selections: array&lt;array&lt;int&gt;&gt;, ~trustees: Trustees.t</span>) =&gt;</span> <span class="hljs-title class_">Ballot</span>.<span class="hljs-property">t</span> = <span class="hljs-string">&quot;encryptBallot&quot;</span>
  @<span class="hljs-title function_">module</span>(<span class="hljs-string">&quot;./belenios&quot;</span>) @<span class="hljs-title function_">scope</span>(<span class="hljs-string">&quot;belenios&quot;</span>) @val external <span class="hljs-attr">_decrypt</span>: <span class="hljs-function">(<span class="hljs-params">string, array&lt;Ballot.t&gt;, Trustees.t, array&lt;string&gt;, Trustees.Privkey.t</span>) =&gt;</span> (<span class="hljs-title class_">PartialDecryption</span>.<span class="hljs-property">t1</span>, <span class="hljs-title class_">PartialDecryption</span>.<span class="hljs-property">t2</span>) = <span class="hljs-string">&quot;decrypt&quot;</span>
  @<span class="hljs-title function_">module</span>(<span class="hljs-string">&quot;./belenios&quot;</span>) @<span class="hljs-title function_">scope</span>(<span class="hljs-string">&quot;belenios&quot;</span>) @val external <span class="hljs-attr">_result</span>: <span class="hljs-function">(<span class="hljs-params">string, array&lt;Ballot.t&gt;, Trustees.t, array&lt;string&gt;, PartialDecryption.t1, PartialDecryption.t2</span>) =&gt;</span> (string) = <span class="hljs-string">&quot;result&quot;</span>

  <span class="hljs-keyword">let</span> <span class="hljs-title function_">create</span> = (<span class="hljs-params">~name, ~description, ~choices, ~trustees</span>) =&gt; <span class="hljs-title function_">parse</span>(<span class="hljs-title function_">_create</span>(~name, ~description, ~choices, ~trustees))
  <span class="hljs-keyword">let</span> <span class="hljs-title function_">vote</span>    = (<span class="hljs-params">o</span>) =&gt; <span class="hljs-title function_">_vote</span>(<span class="hljs-title function_">stringify</span>(o))
  <span class="hljs-keyword">let</span> <span class="hljs-title function_">decrypt</span> = (<span class="hljs-params">o</span>) =&gt; <span class="hljs-title function_">_decrypt</span>(<span class="hljs-title function_">stringify</span>(o))
  <span class="hljs-keyword">let</span> <span class="hljs-title function_">result</span>  = (<span class="hljs-params">o</span>) =&gt; <span class="hljs-title function_">_result</span>(<span class="hljs-title function_">stringify</span>(o))

  <span class="hljs-keyword">let</span> <span class="hljs-title function_">answers</span> = (<span class="hljs-params">params</span>) =&gt;
    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">getExn</span>(params.<span class="hljs-property">questions</span>, <span class="hljs-number">0</span>).<span class="hljs-property">answers</span>
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
